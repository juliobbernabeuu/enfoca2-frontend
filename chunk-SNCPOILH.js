import{$ as A,A as c,C as l,D as u,E as v,F,G as w,H as k,O as L,P as S,Q as D,U as E,Y as I,fa as $,ga as R,ha as N,ia as V,j as m,ja as B,k as p,ka as M,l as x,m as i,n as _,o as C,q as h,qa as U,r as s,ra as T,t as o,u as r,v as f,y,z as g}from"./chunk-Y2HWLAXH.js";function O(n,e){if(n&1&&(o(0,"div",18)(1,"strong"),l(2),r(),o(3,"p",19),l(4),r()()),n&2){let t=e.$implicit;i(2),u(t.nombre||"An\xF3nimo"),i(2),u(t.contenido)}}function P(n,e){n&1&&(o(0,"div",20),l(1," No hay comentarios todav\xEDa. "),r())}function W(n,e){n&1&&f(0,"i",21)}function H(n,e){if(n&1){let t=y();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),f(4,"img",5),r(),o(5,"div",6)(6,"div")(7,"div",7)(8,"strong"),l(9),r(),o(10,"span"),l(11),r()(),f(12,"hr"),o(13,"div",8),h(14,O,5,2,"div",9)(15,P,2,0,"div",10),r()(),o(16,"div")(17,"div",11)(18,"button",12),g("click",function(){m(t);let a=c();return p(a.darLike())}),l(19),r(),o(20,"button",12),g("click",function(){m(t);let a=c();return p(a.foto.descargable?a.descargar():a.comprar())}),h(21,W,1,0,"i",13),l(22),r()(),o(23,"form",14),g("ngSubmit",function(){m(t);let a=c();return p(a.enviarComentario())}),o(24,"div",15)(25,"input",16),k("ngModelChange",function(a){m(t);let b=c();return w(b.nuevoComentario,a)||(b.nuevoComentario=a),p(a)}),r(),o(26,"button",17),l(27,"Publicar"),r()()()()()()()()}if(n&2){let t=c();i(4),s("src",t.foto.url,x),i(5),u(t.foto.nombre_usuario),i(2),u(t.foto.titulo),i(3),s("ngForOf",t.comentarios),i(),s("ngIf",t.comentarios.length===0),i(3),s("ngClass",t.yaLeDioLike?"btn-danger":"btn-outline-light"),i(),v(" \u2764\uFE0F ",t.likes," "),i(),s("ngClass",t.foto.descargable?"btn-success":"btn-warning"),i(),s("ngIf",t.foto.descargable),i(),v(" ",t.foto.descargable?"Descargar":"Comprar por "+t.foto.precio+" \u20AC"," "),i(3),F("ngModel",t.nuevoComentario)}}var j=class n{constructor(e,t){this.route=e;this.http=t}foto;comentarios=[];nuevoComentario="";likes=0;yaLeDioLike=!1;idFoto="";BASE_URL="https://enfoca2-backend.onrender.com";ngOnInit(){this.idFoto=this.route.snapshot.paramMap.get("id")||"",this.cargarFotoDetalle(),this.cargarComentarios(),this.cargarLikes()}cargarFotoDetalle(){this.http.get(`${this.BASE_URL}/api/fotos/detalle/${this.idFoto}`).subscribe(e=>{e.url&&!e.url.startsWith("http")&&(e.url=`${this.BASE_URL}${e.url}`),this.foto=e})}cargarComentarios(){this.http.get(`${this.BASE_URL}/api/comentarios/${this.idFoto}`).subscribe(e=>this.comentarios=e)}enviarComentario(){this.nuevoComentario.trim()&&this.http.post(`${this.BASE_URL}/api/comentarios/${this.idFoto}`,{contenido:this.nuevoComentario}).subscribe(()=>{this.nuevoComentario="",this.cargarComentarios()})}cargarLikes(){this.http.get(`${this.BASE_URL}/api/likes/${this.idFoto}`).subscribe(e=>{this.likes=e.total}),this.http.get(`${this.BASE_URL}/api/likes/verificar/${this.idFoto}`).subscribe(e=>{this.yaLeDioLike=e.dioLike})}darLike(){this.yaLeDioLike?this.http.delete(`${this.BASE_URL}/api/likes/${this.idFoto}`).subscribe(()=>{this.yaLeDioLike=!1,this.likes--}):this.http.post(`${this.BASE_URL}/api/likes/${this.idFoto}`,{}).subscribe(()=>{this.yaLeDioLike=!0,this.likes++})}descargar(){window.open(this.foto.url,"_blank")}comprar(){this.http.post(`${this.BASE_URL}/api/pagos/crear-orden`,{titulo:this.foto.titulo,precio:this.foto.precio}).subscribe({next:e=>{let t=e.id;window.location.href=`https://www.sandbox.paypal.com/checkoutnow?token=${t}`},error:e=>{console.error("Error al crear la orden de PayPal",e),alert("Error al iniciar el proceso de pago.")}})}static \u0275fac=function(t){return new(t||n)(_(A),_(I))};static \u0275cmp=C({type:n,selectors:[["app-foto-detalle"]],decls:1,vars:1,consts:[["class","container-fluid text-light py-4",4,"ngIf"],[1,"container-fluid","text-light","py-4"],[1,"row","justify-content-center","align-items-start",2,"max-width","1000px","margin","0 auto","height","80vh"],[1,"d-flex","p-0","overflow-hidden","rounded-4","shadow-lg",2,"height","100%","width","100%"],[1,"col-md-7","d-flex","justify-content-center","align-items-center","p-0",2,"height","100%"],["alt","Foto",1,"img-fluid","w-100","h-100","object-fit-cover",2,"object-fit","cover",3,"src"],[1,"col-md-5","bg-black","p-4","d-flex","flex-column","justify-content-between",2,"height","100%"],[1,"d-flex","align-items-center","justify-content-between","mb-3"],[1,"overflow-auto","mb-3",2,"max-height","300px"],["class","mb-3",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"d-flex","align-items-center","gap-3","mb-3"],[1,"btn",3,"click","ngClass"],["class","bi-download",4,"ngIf"],[3,"ngSubmit"],[1,"input-group"],["type","text","name","comentario","placeholder","A\xF1ade un comentario...","required","",1,"form-control","bg-secondary","text-light",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary"],[1,"mb-3"],[1,"mb-1"],[1,"text-muted"],[1,"bi-download"]],template:function(t,d){t&1&&h(0,H,28,11,"div",0),t&2&&s("ngIf",d.foto)},dependencies:[E,L,S,D,T,M,$,R,N,U,B,V],encapsulation:2})};export{j as FotoDetalleComponent};
